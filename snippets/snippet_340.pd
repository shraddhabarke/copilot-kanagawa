template <auto Banks, typename Address, auto Addresses>
inline bool validate_bank_indices
    ( optional<Address>[Addresses] addresses
    , (Address) -> index_t<Banks> address_to_bank_index
    ) {
    return all
        ( [address_to_bank_index](optional<Address> address)
          {
              return !address.is_valid || address_to_bank_index(address.value) < Banks;
          }
        , addresses
        );
}